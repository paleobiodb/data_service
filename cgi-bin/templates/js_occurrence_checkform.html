    <script language="JavaScript" type="text/javascript">
    <!-- Begin

	// This is a handy little function for seeing what properties an object has
	function showProperties ( obj ) {
		var result = "";

		for ( var i in obj ) {
			result += "o." + i + " = " + obj[i] + "<BR>\n";
		}
		document.write ( result );
	}

	// Checks for sp. and indet. overrides
	function overrideEntry ( str ) {
		switch ( str ) {
			case 'sp.':   
			case 'spp.':   
			case 'indet.':   
				return true;
				break
			default:
				return false;
        }
	}

	// Checks for pulldown overrides
	function overridePulldown ( sel ) {
		var index = sel.selectedIndex;

		// Must check if -1 or Konquerer dies!
		if ( index != -1 ) {
 			switch ( sel.options[index].text ) {
				case 'informal':
				case 'informal aff.':
				case 'informal cf.':
					return true;
					break
				default:
					return false;
        	}
		}
	}

	// Genus & Subgenus Name
	function checkName ( type, value, pulldown, i ) {
        var	startUppercase = /^[A-Z]/;
        var	firstUpperRestLower = /^[A-Z][a-z]+$/;

		if ( ! overrideEntry ( value ) && ! overridePulldown ( pulldown ) ) {
			// Must start w/ upper case
 			if ( startUppercase.test( value ) == false ) {
				return "The " + type + " name " + value + " must be capitalized.\n"; 
			} else {
				// Check that the rest is acceptable
 				if ( firstUpperRestLower.test( value ) == false ) {
					return "The " + type + " name " + value + " is ill formed.\n"; 
				}
			}
		}
		return "";
	}

	// Species Name
	function checkSpecies ( value, pulldown, i ) {
        var	lowercase = /^[a-z]+$/;

		if ( ! overrideEntry ( value ) && ! overridePulldown ( pulldown ) ) {
			// Species must be all lowercase, no numbers
 			if ( lowercase.test( value ) == false ) {
				return "The species name " + value + " must be lower case, no numbers, no other characters.\n"; 
			}

			// Also check for 'sp' without . typo
			if ( value == "sp" || value == "spp" ) {
				return "The species name " + value + " requires a period. \n"; 
			}
		}
		return "";
	}

    function checkForm() {

		var frm = document.forms[0];
		var rows = frm.row_token.length;
		var errors = "";

		// If there is only one row of data, rows comes back as undefined
		if ( rows ) {
			// Loop over all data rows
			for ( var i=0; i < rows; i++ ) {
				// Genus Name
				if ( frm.genus_name[i].value != "" ) {
					errors += checkName ( "genus", frm.genus_name[i].value, frm.genus_reso[i], i );
					for ( var j=0; j < i; j++ ) {
						if ( frm.genus_reso[i].value == frm.genus_reso[j].value && frm.genus_name[i].value == frm.genus_name[j].value && frm.species_reso[i].value == frm.species_reso[j].value && frm.species_name[i].value == frm.species_name[j].value && i != j && frm.reid_no[i].value == 0 ) {
							if ( ! frm.subgenus_name || ( frm.subgenus_reso[i].value == frm.subgenus_reso[j].value && frm.subgenus_name[i].value == frm.subgenus_name[j].value ) )	{
								errors += frm.genus_name[i].value + " " + frm.species_name[i].value + " is repeated.\n";
							}
						}
					}
				} else {
					// If they don't have the genus, disregard the entire row
					continue;
				}
	
                if ( frm.subgenus_name && frm.subgenus_name[i].value != "" ) {
                    errors += checkName ( "subgenus", frm.subgenus_name[i].value, frm.subgenus_reso[i], i );
                }
	
				// Species must be there
				if ( frm.species_name[i].value == "" ) {
					errors += "A species name is required for " + frm.genus_name[i].value + ".\n"; 
				} else {
					errors += checkSpecies ( frm.species_name[i].value, frm.species_reso[i], i );
				}

				// Reference num
				if ( frm.reference_no[i].value == "" ) {
					errors += "A reference is required for " + frm.genus_name[i].value + " " + frm.species_name[i].value + ".\n"; 
				}
			}
		} else {

			// Only one row!

			// Genus Name
			if ( frm.genus_name.value != "" ) {
				errors += checkName ( "genus", frm.genus_name.value, frm.genus_reso, 1 );

                if ( frm.subgenus_name && frm.subgenus_name[i].value != "" ) {
                    errors += checkName ( "subgenus", frm.subgenus_name[i].value, frm.subgenus_reso[i], i );
                }
	
				// Species must be there
				if ( frm.species_name.value == "" ) {
					errors += "A species name is required for " + frm.genus_name[i].value + ".\n"; 
				} else {
					errors += checkSpecies ( frm.species_name.value, frm.species_reso, 1 );
				}

				// Reference num
				if ( frm.reference_no.value == "" ) {
					errors += "A reference is required for " + frm.genus_name[i].value + " " + frm.species_name[i].value + ".\n"; 
				}
			}
		}
		// Report errors
		if ( errors != "" ) {
			errors = "   Please fix the following errors:   \n" + 
					 "---------------------------------------\n\n" +
					 errors + "\n" +
					 "---------------------------------------\n\n" +
					 "See the tip sheet for instructions.";
			alert ( errors );
			return false;
		} 
		return true;
    }

    //  End -->
    </script>
