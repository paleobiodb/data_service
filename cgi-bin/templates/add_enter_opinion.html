<script language="JavaScript" type="text/javascript">
<!-- Begin

function checkReference(frm,errors) {

    var ref_has_publication_info = 0;
    if (frm.ref_has_opinion) {
        if (frm.ref_has_opinion.checked) {
            ref_has_publication_info = 1;    
        }
    } else if (frm.ref_is_authority) {
        if (frm.ref_has_opinion.checked) {
            ref_has_publication_info = 1;    
        }
    }

    // First, make sure that they either selected the 
    // use current reference check box
    // or fill in some information in the reference fields.
    if (ref_has_publication_info) {
        var other_pub_info_blank = (frm.author1init.value == '' &&
                         frm.author1last.value == '' && 
                         frm.author2init.value == '' &&
                         frm.author2last.value == '' && 
                         frm.otherauthors.value == '' &&
                         frm.pubyr.value == '' &&
                         frm.elements["2nd_pages.value"] == '' &&
                         frm.elements["2nd_figures.value"] == '');
        if (! other_pub_info_blank) {
            errors.add("Don't fill in the named in earlier publication fields if the record was named in the primary reference.");
        }
    } else {  
        // so we need to check the validity of the reference information.
        var ref_pub_info_blank = (frm.pages.value == '' && frm.figures.value == '');
        if (! ref_pub_info_blank) {
            errors.add("You must fill in the primary reference pages and figures if the record was named in an earlier publication");
        } else {
            //at a minimum, we need the author last name and pubyr.
            if (!(properYear(frm.pubyr.value))) {
                errors.add("Ill-formed or missing publication year");
            }

            if (!(properLastName(frm.author1last.value))) {
                errors.add("Ill-formed or missing last name for first author");
            }
            if (frm.author1init.value != "") {
                if (! properInitial(frm.author1init.value)) {
                    errors.add("Ill-formed initial for first author");
                }
            }

            if (frm.author2last.value != "") {
                if (! properInitial(frm.author2last.value)) {
                    errors.add("Ill-formed last name for second author");
                }
            }
            if (frm.author2init.value != "") {
                if (! properInitial(frm.author2init.value)) {
                    errors.add("Ill-formed initial for second author");
                }
            }
        }
    }
    return errors;
}

function checkForm() {
/* TBD another day, this is handled serverside so this isn't necessary
    var frm = document.forms[0];
    var errors = new Error();

    errors = checkReference(frm,errors);

    // figure out the rank of the taxon name.   
    var spellingName = frm.child_spelling_name.value;
    var spellingRank = guessTaxonRank(spellingName);

    var checkedRadio = "";
    for (var i = 0; i < frm.taxon_status.length; i++) {
        if (frm.taxon_status[i].checked) {
            checkedRadio = frm.taxon_status[i].value;
        }
    }

    switch (checkedRadio) {
        case "belongs_to":
            var parentName = frm.belongs_to_parent.value;
            var parentRank = guessTaxonRank(parentName);
            
            if (spellingRank == 'species' || spellingRank == 'subspecies') {
            }
            if (frm.taxon_name.value == "") {
                if ( taxonRank(frm.taxon_name_corrected) == "higher" )  {
                    errors.add("Higher taxon name is missing.");
                } else  {
                    errors.add("Name of combination is missing.");
                }

                break;
            }

            if (frm.taxon_name.value == frm.parent_taxon_name.value)    {
                errors.add("Recombined field can't have the same name as the original taxon.");
            }
            break;
        case "invalid1":
            var field = frm.parent_taxon_name2.value;

            if (field == "") {
                errors.add("The '" + frm.synonym.value + "' field is empty.");
            }

            if (taxonRank(frm.parent_taxon_name2.value) != rank) {
                errors.add("The '" + frm.synonym.value + "' rank doesn't match original rank.");
            }

            if (field == frm.taxon_name_corrected.value) {
                errors.add("The '" + frm.synonym.value + "' field matches the taxon being edited.");
            }

            if (taxonRank(frm.parent_taxon_name2.value) == "invalid") {
                errors.add("'" + frm.synonym.value + "' is ill-formed.");
            }
            break;
    }

    // Report errors
    if (errors.count() > 0) {
        errors.showAlert();
        return false;
    } else {
        return true;
    }
    */
    return true;
}

// END -->
</script>


<span id="message"></span>
<span id="error_message"></span>

<div align="center"><h2>Add/edit opinion record for <span id="child_name"></span></h2></div>

<form method="POST" action="bridge.pl" onSubmit="checkForm()">

<DIV class="mainSection">

<input type="hidden" id="action" name="action" value="submitOpinionForm">
<input type="hidden" id="reference_no" name="reference_no">

<input type="hidden" id="child_no" name="child_no">
<input type="hidden" id="opinion_no" name="opinion_no">
<input type="hidden" id="orig_taxon_status" name="orig_taxon_status">
<input type="hidden" id="confirm_migrate_opinions" name="confirm_migrate_opinions">
<input type="hidden" id="confirm_create_spelling" name="confirm_create_spelling">
<input type="hidden" id="confirm_create_spelling_rank" name="confirm_create_spelling_rank">

<div align="center"><h2>Whose opinion on <span id="child_name"></span> are you entering?</h2></div>

<div class="emphasized" align=left>
<input type="radio" id="ref_has_opinion" name="ref_has_opinion" value="PRIMARY">
The primary reference argues for this opinion:
<div align="center" class="small"><span id="formatted_primary_reference"></span></div>
<!-- OPTIONAL current_reference -->
<br>
<input type="radio" id="ref_has_opinion" name="ref_has_opinion" value="CURRENT">
 ... <i>or</i> the current reference argues for this opinion:
<br><div align="center" class="small"><span id="formatted_current_reference"></span></div>
<!-- END current_reference -->
</div>

<br>
<center>
<p>
<b>Pages*:</b> <input id="pages" name="pages" size=12>
<b>Figures*:</b> <input id="figures" name="figures" size=12>
</p>
</center>


<div class="emphasized" align=left>
<input type="radio" id="ref_has_opinion" name="ref_has_opinion" value="NO">
 ... <i>or</i> the opinion is repeated from an earlier authority, which is:</div>
<br>

<center>
<table>

<tr>
<td></td><td class=tiny>initials</td><td class=tiny>last name</td>
<td></td><td class=tiny>initials</td><td class=tiny>last name</td>
</TR>

<TR><td align=right><b>First author:</b></td>
<td><input id="author1init" name="author1init" size=6></td>
<td><input id="author1last" name="author1last" size=20></td>
<td align=right><b>Second author:</b></td>
<td><input id="author2init" name="author2init" size=6></td>
<td><input id="author2last" name="author2last" size=20></td>
</TR>

<TR><td valign=top align=right><b>Other authors:</b></td>
<td colspan=5><textarea id="otherauthors" name="otherauthors" rows=3 cols=70></textarea></td>
</TR>

<TR><td align=right><b>Year:</b></td>
<td colspan=1><input id="pubyr" name="pubyr" size=6></td>
<td colspan=4><b>Pages*:</b> <input id="2nd_pages" name="2nd_pages" size=12>
<b>Figures*:</b> <input id="2nd_figures" name="2nd_figures" size=12></td>
</TR>
</table>
</center>

<center>
<p><span class="tiny">* Enter numbers of pages and figures that describe and show the type specimen(s).</span></p>
</center>

</div>



<div class="mainSection">
<div align="center"><h2>What did they say about <span id="child_name"></span>?</h2></div>
  
<div class="emphasized">
<b>How was it classified?</b>
</div>
<table  width="100%" border=0 style="padding: 0em 2em 0em 2em;">
  <span id="belongs_to_row"></span>
  <tr>
    <td valign="middle" align=left colspan=3><b>Diagnosis:</b><br>
      <textarea id="diagnosis" name="diagnosis" rows=3 cols=70></textarea>
    </td>
  </tr>
  <span id="synonym_row"></span>
  <span id="nomen_row"></span>

  <tr>
    <td colspan=3 align=left valign=top>
      <b>Comments:</b><BR>
      <textarea id="comments" name="comments" rows=2 cols=70></textarea>
    </td>
  </tr>
  
  <tr>
    <td></td>
    <td align=center colspan=2>
      <span class="tiny"><BR>Please check the 
      <a href="javascript:tipsPopup('/public/tips/taxonomy_tips.html#Status')">tip sheet</a> 
      for an explanation of these terms. <BR>
      </span>
    </td>
  </tr>
</table>
<br>
<div class="emphasized">
<b>How was it spelled?</b>
</div>

<table  width="100%" border=0 style="padding: 0em 2em 0em 2em;">
  <span id="spelling_row"></span>
  <tr><td colspan=2>
    <small>Note that you should select a value regardless of whether this paper was the first to use this combination, spelling, or rank.<small>
  </td></tr>
</table>
</div>

<div align="center">

<table BORDER=0 cellpadding=0>
<tr>
<td style="padding-right: 20px;"><span id="authorizer_name"></span></td>
<td style="padding-right: 20px;"><span id="enterer_name"></span></td>
<td><span id="modifier_name"><span></td>
</tr>
<tr>
<td style="padding-right: 20px;"><span id="created"></span></td>
<td><span id="modified"></span></td>
</tr>
</table> 

<input type=submit value="Submit">

<p>
  <span class="tiny">
    Please read the <a href="javascript:tipsPopup('/public/tips/taxonomy_tips.html#Status')">tip sheet</a> before you press submit.
  </span>
</p>

</div>

</form>
